# Решение проблем с автоматическим деплоем

## Workflow завершился с ошибкой (exit code 1)

### Причина 1: Не настроены секреты FTP

**Симптомы:**
- Workflow падает на шаге "Deploy to Beget via FTP"
- В логах видно "❌ BEGET_FTP_HOST не настроен" или аналогичные сообщения

**Решение:**
1. Откройте репозиторий: https://github.com/MtimurM2907/PDF_Parser_WEB_TS
2. Перейдите: **Settings** → **Secrets and variables** → **Actions**
3. Убедитесь, что есть все три секрета:
   - `BEGET_FTP_HOST` — хост FTP (например, `timurm5h.beget.tech`)
   - `BEGET_FTP_USER` — логин FTP (например, `timurm5h`)
   - `BEGET_FTP_PASSWORD` — пароль FTP

### Причина 2: Неправильный путь на сервере

**Симптомы:**
- FTP подключение успешно, но файлы не загружаются
- Ошибка "directory not found" или "permission denied"

**Решение:**
Проверьте правильный путь к корню сайта на Beget:
- Обычно это `/public_html/` или `./public_html/`
- Может быть `www/timurm5h.beget.tech/public_html/`
- Уточните в панели Beget в разделе "Сайты" → ваш сайт → "Корневая папка"

Если путь другой, отредактируйте `.github/workflows/deploy-to-beget.yml`:
```yaml
server-dir: ./ваш-путь-к-корню-сайта/
```

### Причина 3: Ошибка при сборке проекта

**Симптомы:**
- Workflow падает на шаге "Build Frontend" или "Publish .NET application"
- В логах видны ошибки компиляции

**Решение:**
1. Проверьте логи конкретного шага в GitHub Actions
2. Убедитесь, что проект собирается локально:
   ```powershell
   cd pdf_parser_web_ts.client
   npm run build
   cd ..
   cd PDF_Parser_WEB_TS.Server
   dotnet publish -c Release -o ./publish
   ```

### Причина 4: FTP недоступен или заблокирован

**Симптомы:**
- Ошибка подключения к FTP
- "Connection timeout" или "Connection refused"

**Решение:**
1. Проверьте, что FTP включен в панели Beget
2. Убедитесь, что используете правильный хост (может быть IP вместо домена)
3. Проверьте, не блокирует ли файрвол/FTP-клиент подключение

---

## Как посмотреть детальные логи ошибки

1. Откройте репозиторий на GitHub
2. Перейдите в **Actions**
3. Кликните на упавший workflow (красный крестик)
4. Кликните на упавший job (например, `build-and-deploy`)
5. Разверните шаг, где произошла ошибка
6. Прочитайте логи — там будет точная причина ошибки

---

## Быстрая проверка настроек

Выполните в терминале локально:

```powershell
# Проверка сборки фронтенда
cd pdf_parser_web_ts.client
npm run build

# Проверка сборки бэкенда
cd ..
cd PDF_Parser_WEB_TS.Server
dotnet publish -c Release -o ./publish

# Проверка наличия файлов
ls publish
```

Если всё собирается локально, проблема скорее всего в:
- Не настроенных секретах GitHub
- Неправильном пути на сервере
- Проблемах с FTP подключением

---

## Альтернатива: Ручной деплой

Если автоматический деплой не работает, используйте ручной:

1. Соберите проект локально (как выше)
2. Загрузите содержимое `publish` на Beget через файловый менеджер или FTP-клиент
3. Обновляйте вручную при каждом изменении

Это надёжнее, но требует ручной работы при каждом обновлении.
